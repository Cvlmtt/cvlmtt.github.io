<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Basic Pentesting 2 - Walkthrough</title>

  <!-- Project-wide theme -->
  <link rel="stylesheet" href="../style/style.css" />

  <!-- Walkthrough-specific styles -->
  <link rel="stylesheet" href="bp2.css" />
</head>

<body>

  <header class="site-header">
    <div class="container">
      <h1>Basic Pentesting 2</h1>
      <div class="bp2-top-nav">
        <a href="../index.html">← Back to index</a>
      </div>
    </div>
  </header>

  <main class="bp2-article">

    <p>
      After downloading the <code>.ova</code> file from
      <a href="https://www.vulnhub.com/entry/basic-pentesting-2,241/" target="_blank" rel="noopener noreferrer">VulnHub</a>
      and configuring the network, I immediately ran a scan on the entire laboratory subnet to find the IP address assigned to the VM:
    </p>

    <pre><code>nmap -sV -O -Pn 192.168.56.0/24</code></pre>

    <a class="bp2-img-link" href="img/nmap-basic2.png" data-caption="Nmap scan - host discovery and service detection">
      <img src="img/nmap-basic2.png" alt="Nmap basic pentesting 2" />
    </a>

    <p>
      <code>nmap</code> identifies a host with IP address <code>192.168.56.29</code> and the following open ports:
      22 (SSH), 80 (HTTP), 139 (SMB), 445 (SMB), 8009, 8080 (Apache Tomcat).
      Let us try to access the website exposed on port 80:
    </p>

    <a class="bp2-img-link" href="img/index-basic2.png" data-caption="Port 80 - website index page">
      <img src="img/index-basic2.png" alt="Index page website basic pentesting 2" />
    </a>
    <a class="bp2-img-link" href="img/index-curl-basic2.png" data-caption="Port 80 - request with curl">
      <img src="img/index-curl-basic2.png" alt="Index page request with curl" />
    </a>

    <p>
      From both the browser and through <code>curl</code>, it seems there is nothing relevant.
    </p>

    <p>
      Therefore, we perform a deeper scan using <code>nmap</code> scripts, <code>vulners</code> and <code>vuln</code>, to verify
      whether there are known vulnerabilities.
    </p>

    <a class="bp2-img-link" href="img/nmap-scripts-basic2.png" data-caption="Nmap scripts - additional checks and enumeration">
      <img src="img/nmap-scripts-basic2.png" alt="Nmap scripts basic pentesting 2" />
    </a>

    <p>
      The <code>nmap</code> scripts run other scripts to verify the presence of vulnerabilities. One of them, for example, is
      <code>http-enum</code>, which tries to enumerate pages exposed by the web server. In this case, the output of <code>http-enum</code>
      for port 80 says:
    </p>

    <pre><code>| http-enum: 
|_  /development/: Potentially interesting directory w/ listing on 'apache/2.4.18 (ubuntu)'</code></pre>

    <div class="bp2-note">
      <strong>Note:</strong> in this case, we can get the same result using the tool <code>dirb</code>, running
      <code>dirb http://&lt;IP_ADDRESS&gt;</code>:
    </div>

    <a class="bp2-img-link" href="img/dirb-out-basic2.png" data-caption="dirb output - directory brute forcing on port 80">
      <img src="img/dirb-out-basic2.png" alt="dirb output" />
    </a>

    <p>Let us visit this directory:</p>

    <a class="bp2-img-link" href="img/devel-dir-basic2.png" data-caption="/development/ directory listing">
      <img src="img/devel-dir-basic2.png" alt="development directory" />
    </a>
    <a class="bp2-img-link" href="img/devel-dir-dev-file-basic2.png" data-caption="dev.txt - internal messages">
      <img src="img/devel-dir-dev-file-basic2.png" alt="dev.txt file" />
    </a>
    <a class="bp2-img-link" href="img/devel-dir-j-fale-basic-2.png" data-caption="j.txt - internal message about weak password">
      <img src="img/devel-dir-j-fale-basic-2.png" alt="j.txt file" />
    </a>

    <p>
      The file <code>dev.txt</code> seems to contain messages from two users of the machine and we can read that the one who signs with
      <em>-K</em> left a message saying that SMB has been configured.
      The file <code>j.txt</code> seems to be a message written by <em>-K</em> specifically for <em>-J</em>, and it informs us that the user
      password (whose hash can be obtained from the file <code>/etc/shadow</code>) used by <em>-J</em> is particularly easy to crack.
      Therefore, <em>-K</em> asks <em>-J</em> to change the password following the guidelines. Hmm, this information can be useful.
    </p>

    <p>
      From the <code>nmap</code> output and from the messages left in <code>dev.txt</code> we know that the SMB service is active, a file sharing
      service between nodes in a network. The tool <code>enum4linux</code> is described as:
      <em>
        “Simple wrapper around the tools in the samba package to provide similar functionality to enum.exe (formerly from www.bindview.com).
        Some additional features such as RID cycling have also been added for convenience.”
      </em>
      Let us try to find useful information by running <code>enum4linux 192.168.56.29</code>:
    </p>

    <a class="bp2-img-link" href="img/enum4linux-basic2.png" data-caption="enum4linux output - SMB enumeration and user discovery">
      <img src="img/enum4linux-basic2.png" alt="enum4linux output" />
    </a>

    <p>
      <code>enum4linux</code> identifies two users: <strong>kay</strong> and <strong>jan</strong>. Remembering the initials used in the messages in
      <code>dev.txt</code>, we can link these two users to the developers. Moreover, we know that <strong>jan</strong> uses a password that is easy
      to crack. We can try <code>hydra</code>!
    </p>

    <p><em>Hydra is a parallelized login cracker which supports numerous protocols to attack. It is very fast and flexible, and new modules are easy to add.</em></p>
    <p><em>This tool makes it possible for researchers and security consultants to show how easy it would be to gain unauthorized access to a system remotely.</em></p>
    <p>
      <em>
        It supports: Cisco AAA, Cisco auth, Cisco enable, CVS, FTP, HTTP(S)-FORM-GET, HTTP(S)-FORM-POST, HTTP(S)-GET, HTTP(S)-HEAD, HTTP-Proxy,
        ICQ, IMAP, IRC, LDAP, MS-SQL, MySQL, NNTP, Oracle Listener, Oracle SID, PC-Anywhere, PC-NFS, POP3, PostgreSQL, RDP, Rexec, Rlogin, Rsh,
        SIP, SMB(NT), SMTP, SMTP Enum, SNMP v1+v2+v3, SOCKS5, SSH (v1 and v2), SSHKEY, Subversion, Teamspeak (TS2), Telnet, VMware-Auth, VNC and XMPP.
      </em>
    </p>

    <p>
      Among the supported protocols there is also SSH, which we know is enabled on the target machine from the <code>nmap</code> output.
      Also, we know that the password of user <strong>jan</strong> is easy to crack, so it should not be too hard to access via SSH. Let us run:
    </p>

    <pre><code>hydra -l jan -P /usr/share/wordlist/rockyou.txt 192.168.56.29 ssh</code></pre>

    <p>
      With the <code>-l</code> option we specify the user we want to attack, and with <code>-P</code> we specify the wordlist to use as a dictionary
      for the attack (in this case <code>rockyou.txt</code>, provided by default in Kali). Then we specify the target IP address and the protocol.
    </p>

    <a class="bp2-img-link" href="img/hydra-basic2.png" data-caption="Hydra output - password found for user jan">
      <img src="img/hydra-basic2.png" alt="Hydra output" />
    </a>

    <p>
      Found it! The password for user <strong>jan</strong> is <strong>armando</strong>. Let us log in via SSH with these credentials:
    </p>

    <a class="bp2-img-link" href="img/ssh-jan-basic2.png" data-caption="SSH login as jan">
      <img src="img/ssh-jan-basic2.png" alt="SSH jan" />
    </a>

    <p>
      Great, we logged in as user <strong>jan</strong>. In <strong>jan</strong>'s home directory there is nothing particularly useful.
      Let us see what we can get from <strong>kay</strong>'s home directory:
    </p>

    <a class="bp2-img-link" href="img/kay-home-basic2.png" data-caption="kay home directory - pass.bak visible but not readable as jan">
      <img src="img/kay-home-basic2.png" alt="kay home" />
    </a>

    <p>
      We notice the file <code>pass.bak</code>, which could be interesting, but we cannot access it due to permissions (read and write only for the owner
      of the file, i.e., <strong>kay</strong>). However, we can enter the <code>.ssh</code> directory:
    </p>

    <a class="bp2-img-link" href="img/ssh-dir-kay-basic2.png" data-caption="kay .ssh directory - id_rsa is world-readable">
      <img src="img/ssh-dir-kay-basic2.png" alt=".ssh dir" />
    </a>

    <p>
      We can see that the file <code>id_rsa</code> can be read by anyone. By running:
    </p>

    <pre><code>cat /home/kay/.ssh/id_rsa</code></pre>

    <p>
      we can copy its content and create a local copy on our system. In my case I pasted the content into a file named <code>kay_id_rsa</code>.<br>
      <code>id_rsa</code> is an SSH private key. When a private key is protected by a passphrase, the passphrase is not stored in plaintext because the file
      contains an encrypted structure with encryption parameters, salt, and data derived from the passphrase. The Python script <code>ssh2john.py</code> is used
      to extract the cryptographic parameters from the SSH private key and convert them to a format John the Ripper can process, enabling offline cracking of the passphrase.
      So we run:
    </p>

    <pre><code>python3 /usr/share/john/ssh2john.py kay_id_rsa &gt; kay_id_rsa.hash</code></pre>

    <p>
      The output is very long. It contains the hash in a format compatible with John the Ripper. (If you want, you can paste the full line here in your local copy.)
    </p>

    <div class="bp2-note">
      <strong>Note:</strong> the <code>ssh2john.py</code> script is available by default in Kali Linux at the specified path.
    </div>

    <p>Now we simply run John on the generated hash file:</p>

    <pre><code>john --wordlist=/usr/share/wordlist/rockyou.txt kay_id_rsa.hash</code></pre>

    <p>
      John cracks the passphrase easily, which is: <code>beeswax</code>. At this point we have the passphrase needed to log in via SSH as user <strong>kay</strong>
      using the RSA key. From the shell where we are logged in as <strong>jan</strong>, we move into <code>/home/kay/.ssh</code> and run:
    </p>

    <pre><code>ssh -i id_rsa kay@localhost</code></pre>

    <p>and, when asked, we enter the passphrase we found.</p>

    <a class="bp2-img-link" href="img/kay_login.png" data-caption="SSH login as kay using id_rsa + passphrase">
      <img src="img/kay_login.png" alt="Kay login" />
    </a>

    <p>
      Great! Now we can read the file <code>pass.bak</code> because we have the required permissions. We run:
    </p>

    <pre><code>cat pass.bak</code></pre>

    <p>
      and we obtain the following string: <code>heresareallystrongpasswordthatfollowsthepasswordpolicy$$</code>. As it says, it looks like a password considered “strong”
      by the policy. We can try it as the root password. Let us test:
    </p>

    <pre><code>sudo su</code></pre>

    <p>and we enter the password when requested. Eureka!! We obtained a root shell.</p>

    <a class="bp2-img-link" href="img/root-shell.png" data-caption="Root shell obtained via sudo su">
      <img src="img/root-shell.png" alt="Root shell" />
    </a>

  </main>

  <!-- Lightbox overlay -->
  <div id="bp2-lightbox" class="bp2-lightbox" aria-hidden="true">
    <div class="bp2-lightbox-inner">
      <button id="bp2-lightbox-close" class="bp2-lightbox-close" type="button" aria-label="Close image">Close</button>
      <img id="bp2-lightbox-img" class="bp2-lightbox-img" src="" alt="" />
      <div id="bp2-lightbox-caption" class="bp2-lightbox-caption"></div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container">
      <p>© 2025 - Walkthroughs by <strong>tuo-username</strong></p>
    </div>
  </footer>

  <!-- Walkthrough-specific script -->
  <script src="bp2.js"></script>
</body>
</html>
